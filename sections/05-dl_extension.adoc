
== DL Extension

A DLA, generated by a Calendar Server, MAY be included
into a TST compliant to <<RFC3161>> using a non critical extension.

The use of non critical extension is backward compatible with software currently availables.

The extension MUST follow the specifications described in <<RFC3161>> and <<RFC3280,4.2.1 of>>.

The OID of the new extension MUST have the following root registered at IANA (see <<#iana>>):

    id-ce-dlext   OBJECT IDENTIFIER ::= { id-ce 99 }

where id-ce identify the root of standard extensions as described in <<RFC3280>>.

=== Promise

This extension contain the promise obtained from a Calendar Server in response to a timestamp request on the DL.
The ASN.1 structure is as follow:

    id-ce-dlext-promise OBJECT IDENTIFIER ::= { id-ce-dlext 1 }

    Promise ::= SEQUENCE {
        version          [0] INTEGER,
        dlpromise        [1] DLPromise }

    DLPromise ::= OCTET STRING

The data timestamped by the DLA SHALL be an hash of
the same data that will be signed by the TSA without the DL extension itself.

=== Proof

This extension contain the proof obtained from a Calendar Server in response to a timestamp upgrade request of a previously obtained promise.
The ASN.1 structure is as follow:

    id-ce-dlext-proof OBJECT IDENTIFIER ::= { 
        id-ce-dlext 2 }

    Proof ::= SEQUENCE {
          version        [0] INTEGER,
          dlproof        [1] DLProof,
          blockchain     [2] UTF8String }

    DLProof ::= OCTET STRING


The upgrade from a promise to a proof MAY be done requesting a new TST, including
the DL extension containing the promise prevously obtained.
When the TSA receive a request containing a DL extension
if there is a pending promise inside, it MAY request the Calendar Server to get the
proof and MAY include it in the new TST.
